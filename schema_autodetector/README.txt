Here's the code I used for schema autodetection.
I don't expect this to be directly usable by anyone else,
but if you're interested email me for some instructions.
