#!/usr/bin/env ruby

require "fileutils"

FileUtils.mkdir_p "tmp"

samples = %W[
  trade_routes.esf
  sea_grids.esf
  poi.esf
  pathfinding.esf
  regions.esf
  bmd.dat
  startpos.esf
].sort_by{|fn| File.size("samples/#{fn}") }

samples.each do |filename|
  source    = "samples/#{filename}"
  xmldir    = "tmp/" + filename.gsub(".", "_") + "_dir"
  recreated = "tmp/recreated_#{filename}"
  
  puts "Verifying #{filename}"
  
  FileUtils.rm_rf xmldir
  system "./esf2xml", source, xmldir

  FileUtils.rm_rf recreated
  system "./xml2esf", xmldir, recreated

  system "diff", source, recreated
end
